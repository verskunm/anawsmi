"object"!=typeof JSON&&(JSON={}),function(){"use strict";var rx_one=/^[\],:{}\s]*$/,rx_two=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,rx_three=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,rx_four=/(?:^|:|,)(?:\s*\[)+/g,rx_escapable=/[\\"\u0000-\u001f\u007f-\u009f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,rx_dangerous=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;function f(n){return n<10?"0"+n:n}function this_value(){return this.valueOf()}"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},Boolean.prototype.toJSON=this_value,Number.prototype.toJSON=this_value,String.prototype.toJSON=this_value);var gap,indent,meta,rep;function quote(string){return rx_escapable.lastIndex=0,rx_escapable.test(string)?'"'+string.replace(rx_escapable,function(a){var c=meta[a];return"string"==typeof c?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+string+'"'}function str(key,holder){var i,k,v,length,mind=gap,partial,value=holder[key];switch(value&&"object"==typeof value&&"function"==typeof value.toJSON&&(value=value.toJSON(key)),"function"==typeof rep&&(value=rep.call(holder,key,value)),typeof value){case"string":return quote(value);case"number":return isFinite(value)?String(value):"null";case"boolean":case"null":return String(value);case"object":if(!value)return"null";if(gap+=indent,partial=[],"[object Array]"===Object.prototype.toString.apply(value)){for(length=value.length,i=0;i<length;i+=1)partial[i]=str(i,value)||"null";return v=0===partial.length?"[]":gap?"[\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"]":"["+partial.join(",")+"]",gap=mind,v}if(rep&&"object"==typeof rep)for(length=rep.length,i=0;i<length;i+=1)"string"==typeof rep[i]&&(k=rep[i],(v=str(k,value))&&partial.push(quote(k)+(gap?": ":":")+v));else for(k in value)Object.prototype.hasOwnProperty.call(value,k)&&(v=str(k,value))&&partial.push(quote(k)+(gap?": ":":")+v);return v=0===partial.length?"{}":gap?"{\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"}":"{"+partial.join(",")+"}",gap=mind,v}}"function"!=typeof JSON.stringify&&(meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},JSON.stringify=function(value,replacer,space){var i;if(gap="",indent="","number"==typeof space)for(i=0;i<space;i+=1)indent+=" ";else"string"==typeof space&&(indent=space);if(rep=replacer,replacer&&"function"!=typeof replacer&&("object"!=typeof replacer||"number"!=typeof replacer.length))throw new Error("JSON.stringify");return str("",{"":value})}),"function"!=typeof JSON.parse&&(JSON.parse=function(text,reviver){var j;function walk(holder,key){var k,v,value=holder[key];if(value&&"object"==typeof value)for(k in value)Object.prototype.hasOwnProperty.call(value,k)&&(v=walk(value,k),void 0!==v?value[k]=v:delete value[k]);return reviver.call(holder,key,value)}if(text=String(text),rx_dangerous.lastIndex=0,rx_dangerous.test(text)&&(text=text.replace(rx_dangerous,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})),rx_one.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}(),function(global){global.inDapIF&&(global=global.parent);var Settings,error;Settings={flavor:"Skroutz",redirectTo:function(url){return Settings.window.location.replace(url)},iframe_message:"get_analytics_session",single_beacon:!1,xdomain_session_timeout:5e3,auto_pageview_timeout:1e3,send_auto_pageview:!0,params:{analytics_session:"analytics_session",signature:"sig",url:"url",referrer:"referer",shop_code:"shop_code",metadata:"metadata",actions:"actions",transaction_id:"transaction_id",cookie_policy:"cp"},cookies:{version:1,basic:{analytics:{name:"__b_sa_session",duration:1800},session:{name:"__b_skr_nltcs_ss",duration:2592e3},meta:{name:"__b_skr_nltcs_mt"}},full:{analytics:{name:"__sa_session",duration:1800},session:{name:"__skr_nltcs_ss",duration:2592e3},meta:{name:"__skr_nltcs_mt"}}},url:{base:"https://analytics.skroutz.gr",application_base:"https://www.skroutz.gr",analytics_session:{create:function(shop_code,flavor,session,cookie_policy,metadata){return"https://analytics.skroutz.gr/track/create?shop_code="+shop_code+"&flavor="+flavor+"&session="+session+"&cp="+cookie_policy+"&metadata="+metadata},connect:function(shop_code){return"https://analytics.skroutz.gr/track/connect?shop_code="+shop_code}},beacon:function(analytics_session){return"https://analytics.skroutz.gr/track/actions/create?analytics_session="+analytics_session}},api:{settings:{key:"settings",set_account:"setAccount",set_callback:"setCallback",redirect_to:"redirectTo"},yogurt:{key:"yogurt",product_click:"productClick"},site:{key:"site",send_pageview:"sendPageView"},ecommerce:{key:"ecommerce",add_item:"addItem",add_transaction:"addTransaction"}}};try{Settings.window=global}catch(error){Settings.window=this}Settings.command_queue_name=Settings.window.SkroutzAnalyticsObject||"sa",Settings.window[Settings.command_queue_name]=Settings.window[Settings.command_queue_name]||function(){(Settings.window[Settings.command_queue_name].q=Settings.window[Settings.command_queue_name].q||[]).push(arguments)},Settings.window[Settings.command_queue_name].q=Settings.window[Settings.command_queue_name].q||[],Settings.commands_queue=Settings.window[Settings.command_queue_name].q,Settings.url.current=Settings.window.location.href,Settings.url.referrer=Settings.window.document.referrer,Settings.url.hostname=Settings.window.location.hostname,Settings.custom_tlds=["skroutzstore.gr"];var bind=function(fn,me){return function(){return fn.apply(me,arguments)}},slice=[].slice,Promise,UID;UID=1,Promise=function(){Promise._all=function(promises,fail_fast){var bound_fail,bound_success,done_count,fail,fail_count,i,index,len,promise,promise_all,reject_results,rejected,results,success;if(promise_all=new Promise,rejected=!1,results=[],reject_results=[],done_count=promises.length,fail_count=0,0===done_count)return promise_all.resolve(!0),promise_all;for(success=function(index,result){if(results[index]=result,0==--done_count)return promise_all.resolve(results)},fail=function(index,result){if(!rejected)return reject_results[index]=result,fail_fast?(promise_all.reject(result),void(rejected=!0)):++fail_count===promises.length?promise_all.reject(reject_results):success(index,void 0)},index=i=0,len=promises.length;i<len;index=++i)promise=promises[index],bound_success=function(index){return function(){var args;return args=1<=arguments.length?slice.call(arguments,0):[],args.unshift(index),success.apply(null,args)}}(index),bound_fail=function(index){return function(){var args;return args=1<=arguments.length?slice.call(arguments,0):[],args.unshift(index),fail.apply(null,args)}}(index),promise.then(bound_success,bound_fail);return promise_all},Promise.all=function(promises){return Promise._all(promises,!0)},Promise.any=function(promises){return Promise._all(promises,!1)};function Promise(){this.reject=bind(this.reject,this),this.resolve=bind(this.resolve,this),this._id=UID++,this.state="pending",this._thens=[]}return Promise.prototype.then=function(on_resolve,on_reject){return this._thens.push({resolve:on_resolve,reject:on_reject}),this},Promise.prototype.resolve=function(val){return this._complete("resolve",val),this},Promise.prototype.reject=function(val){return this._complete("reject",val),this},Promise.prototype._already=function(){throw new Error("Promise already completed.")},Promise.prototype._complete=function(which,arg){var fulfilment,i,len,ref,rejecter,resolver;for(resolver=function(_this){return function(res,rej){return res&&res(arg),_this}}(this),rejecter=function(_this){return function(res,rej){return rej&&rej(arg),_this}}(this),"resolve"===which?(this.state="fulfilled",this.then=resolver):(this.state="rejected",this.then=rejecter),this.resolve=this.reject=this._already,ref=this._thens,i=0,len=ref.length;i<len;i++)fulfilment=ref[i],"function"==typeof fulfilment[which]&&fulfilment[which](arg);return delete this._thens},Promise}();var slice=[].slice,Runnable;Runnable=function(){function Runnable(){}return Runnable.run=function(){var _,args,category,cmd,ref,ref1,type;ref=Settings.window[Settings.command_queue_name].q.slice();for(_ in ref)cmd=ref[_],category=cmd[0],type=cmd[1],args=3<=cmd.length?slice.call(cmd,2):[],null!=(null!=(ref1=this._commands[category])?ref1[type]:void 0)&&(this._commands[category][type].apply(this,args),Settings.window[Settings.command_queue_name].q.splice(Settings.window[Settings.command_queue_name].q.indexOf(cmd),1));return this},Runnable}();var Biskoto;Biskoto=function(){var decode,encode;function Biskoto(){}return encode=encodeURIComponent,decode=decodeURIComponent,Biskoto.get=function(name){var cookie,cookies,err,error,i,len,value;if(document.cookie)for(cookies=document.cookie.split(/;\s/g),i=0,len=cookies.length;i<len;i++)if(cookie=cookies[i],0===cookie.indexOf(name)){value=decode(cookie.split("=")[1]);try{return JSON.parse(value)}catch(error){return err=error,value}}return null},Biskoto.set=function(name,value,options){return null==options&&(options={}),document.cookie=name+"="+encode(JSON.stringify(value))+this._cookieOptions(options)},Biskoto.expire=function(name,options){return null==options&&(options={}),options.expires=-1,this.set(name,"",options)},Biskoto._cookieOptions=function(options){var cookie_str,key,value;null==options&&(options={}),cookie_str="";for(key in options)value=options[key],"expires"===key?cookie_str+="; expires="+this._createExpireDate(options.expires):"domain"===key&&(cookie_str+="; domain="+value);return cookie_str+="; path="+(options.path?options.path:"/")},Biskoto._createExpireDate=function(seconds){return new Date(+new Date+1e3*seconds).toUTCString()},Biskoto}();var easyXDM;!function(window,document,location,setTimeout,decodeURIComponent,encodeURIComponent){var global=this,channelId=Math.floor(1e4*Math.random()),emptyFn=Function.prototype,reURI=/^((http.?:)\/\/([^:\/\s]+)(:\d+)*)/,reParent=/[\-\w]+\/\.\.\//,reDoubleSlash=/([^:])\/\//g,namespace="",easyXDM={},_easyXDM=window.easyXDM,IFRAME_PREFIX="easyXDM_",HAS_NAME_PROPERTY_BUG,useHash=!1,flashVersion,HAS_FLASH_THROTTLED_BUG;function isHostMethod(object,property){var t=typeof object[property];return"function"==t||!("object"!=t||!object[property])||"unknown"==t}function isHostObject(object,property){return!("object"!=typeof object[property]||!object[property])}function isArray(o){return"[object Array]"===Object.prototype.toString.call(o)}function hasFlash(){var name="Shockwave Flash",mimeType="application/x-shockwave-flash";if(!undef(navigator.plugins)&&"object"==typeof navigator.plugins[name]){var description=navigator.plugins[name].description;description&&!undef(navigator.mimeTypes)&&navigator.mimeTypes[mimeType]&&navigator.mimeTypes[mimeType].enabledPlugin&&(flashVersion=description.match(/\d+/g))}if(!flashVersion){var flash;try{flash=new ActiveXObject("ShockwaveFlash.ShockwaveFlash"),flashVersion=Array.prototype.slice.call(flash.GetVariable("$version").match(/(\d+),(\d+),(\d+),(\d+)/),1),flash=null}catch(notSupportedException){}}if(!flashVersion)return!1;var major=parseInt(flashVersion[0],10),minor=parseInt(flashVersion[1],10);return HAS_FLASH_THROTTLED_BUG=major>9&&minor>0,!0}var on,un;if(isHostMethod(window,"addEventListener"))on=function(target,type,listener){target.addEventListener(type,listener,!1)},un=function(target,type,listener){target.removeEventListener(type,listener,!1)};else{if(!isHostMethod(window,"attachEvent"))throw new Error("Browser not supported");on=function(object,sEvent,fpNotify){object.attachEvent("on"+sEvent,fpNotify)},un=function(object,sEvent,fpNotify){object.detachEvent("on"+sEvent,fpNotify)}}var domIsReady=!1,domReadyQueue=[],readyState;"readyState"in document?(readyState=document.readyState,domIsReady="complete"==readyState||~navigator.userAgent.indexOf("AppleWebKit/")&&("loaded"==readyState||"interactive"==readyState)):domIsReady=!!document.body;function dom_onReady(){if(!domIsReady){domIsReady=!0;for(var i=0;i<domReadyQueue.length;i++)domReadyQueue[i]();domReadyQueue.length=0}}if(!domIsReady){if(isHostMethod(window,"addEventListener"))on(document,"DOMContentLoaded",dom_onReady);else if(on(document,"readystatechange",function(){"complete"==document.readyState&&dom_onReady()}),document.documentElement.doScroll&&window===top){var doScrollCheck=function(){if(!domIsReady){try{document.documentElement.doScroll("left")}catch(e){return void setTimeout(doScrollCheck,1)}dom_onReady()}};doScrollCheck()}on(window,"load",dom_onReady)}function whenReady(fn,scope){if(domIsReady)return void fn.call(scope);domReadyQueue.push(function(){fn.call(scope)})}function getParentObject(){var obj=parent;if(""!==namespace)for(var i=0,ii=namespace.split(".");i<ii.length;i++)obj=obj[ii[i]];return obj.easyXDM}function noConflict(ns){return window.easyXDM=_easyXDM,namespace=ns,namespace&&(IFRAME_PREFIX="easyXDM_"+namespace.replace(".","_")+"_"),easyXDM}function getDomainName(url){return url.match(reURI)[3]}function getPort(url){return url.match(reURI)[4]||""}function getLocation(url){var m=url.toLowerCase().match(reURI),proto=m[2],domain=m[3],port=m[4]||"";return("http:"==proto&&":80"==port||"https:"==proto&&":443"==port)&&(port=""),proto+"//"+domain+port}function resolveUrl(url){if(url=url.replace(reDoubleSlash,"$1/"),!url.match(/^(http||https):\/\//)){var path="/"===url.substring(0,1)?"":location.pathname;"/"!==path.substring(path.length-1)&&(path=path.substring(0,path.lastIndexOf("/")+1)),url=location.protocol+"//"+location.host+path+url}while(reParent.test(url))url=url.replace(reParent,"");return url}function appendQueryParameters(url,parameters){var hash="",indexOf=url.indexOf("#");indexOf!==-1&&(hash=url.substring(indexOf),url=url.substring(0,indexOf));var q=[];for(var key in parameters)parameters.hasOwnProperty(key)&&q.push(key+"="+encodeURIComponent(parameters[key]));return url+(useHash?"#":url.indexOf("?")==-1?"?":"&")+q.join("&")+hash}var query=function(input){input=input.substring(1).split("&");var data={},pair,i=input.length;while(i--)pair=input[i].split("="),data[pair[0]]=decodeURIComponent(pair[1]);return data}(/xdm_e=/.test(location.search)?location.search:location.hash);function undef(v){return void 0===v}var getJSON=function(){var cached={},obj={a:[1,2,3]},json='{"a":[1,2,3]}';return"undefined"!=typeof JSON&&"function"==typeof JSON.stringify&&JSON.stringify(obj).replace(/\s/g,"")===json?JSON:(Object.toJSON&&Object.toJSON(obj).replace(/\s/g,"")===json&&(cached.stringify=Object.toJSON),"function"==typeof String.prototype.evalJSON&&(obj=json.evalJSON(),obj.a&&3===obj.a.length&&3===obj.a[2]&&(cached.parse=function(str){return str.evalJSON()})),cached.stringify&&cached.parse?(getJSON=function(){return cached},cached):null)};function apply(destination,source,noOverwrite){var member;for(var prop in source)source.hasOwnProperty(prop)&&(prop in destination?(member=source[prop],"object"==typeof member?apply(destination[prop],member,noOverwrite):noOverwrite||(destination[prop]=source[prop])):destination[prop]=source[prop]);return destination}function testForNamePropertyBug(){var form=document.body.appendChild(document.createElement("form")),input=form.appendChild(document.createElement("input"));input.name=IFRAME_PREFIX+"TEST"+channelId,HAS_NAME_PROPERTY_BUG=input!==form.elements[input.name],document.body.removeChild(form)}function createFrame(config){undef(HAS_NAME_PROPERTY_BUG)&&testForNamePropertyBug();var frame;HAS_NAME_PROPERTY_BUG?frame=document.createElement('<iframe name="'+config.props.name+'"/>'):(frame=document.createElement("IFRAME"),frame.name=config.props.name),frame.id=frame.name=config.props.name,delete config.props.name,"string"==typeof config.container&&(config.container=document.getElementById(config.container)),config.container||(apply(frame.style,{position:"absolute",top:"-2000px",left:"0px"}),config.container=document.body);var src=config.props.src;if(config.props.src="javascript:false",apply(frame,config.props),frame.border=frame.frameBorder=0,frame.allowTransparency=!0,config.container.appendChild(frame),config.onLoad&&on(frame,"load",config.onLoad),config.usePost){var form=config.container.appendChild(document.createElement("form")),input;if(form.target=frame.name,form.action=src,form.method="POST","object"==typeof config.usePost)for(var i in config.usePost)config.usePost.hasOwnProperty(i)&&(HAS_NAME_PROPERTY_BUG?input=document.createElement('<input name="'+i+'"/>'):(input=document.createElement("INPUT"),input.name=i),input.value=config.usePost[i],form.appendChild(input));form.submit(),form.parentNode.removeChild(form)}else frame.src=src;return config.props.src=src,frame}function checkAcl(acl,domain){"string"==typeof acl&&(acl=[acl]);var re,i=acl.length;while(i--)if(re=acl[i],re=new RegExp("^"==re.substr(0,1)?re:"^"+re.replace(/(\*)/g,".$1").replace(/\?/g,".")+"$"),re.test(domain))return!0;return!1}function prepareTransportStack(config){var protocol=config.protocol,stackEls;if(config.isHost=config.isHost||undef(query.xdm_p),useHash=config.hash||!1,config.props||(config.props={}),config.isHost)config.remote=resolveUrl(config.remote),config.channel=config.channel||"default"+channelId++,config.secret=Math.random().toString(16).substring(2),undef(protocol)&&(protocol=getLocation(location.href)==getLocation(config.remote)?"4":isHostMethod(window,"postMessage")||isHostMethod(document,"postMessage")?"1":config.swf&&isHostMethod(window,"ActiveXObject")&&hasFlash()?"6":"Gecko"===navigator.product&&"frameElement"in window&&navigator.userAgent.indexOf("WebKit")==-1?"5":config.remoteHelper?"2":"0");else if(config.channel=query.xdm_c.replace(/["'<>\\]/g,""),config.secret=query.xdm_s,config.remote=query.xdm_e.replace(/["'<>\\]/g,""),protocol=query.xdm_p,config.acl&&!checkAcl(config.acl,config.remote))throw new Error("Access denied for "+config.remote);switch(config.protocol=protocol,protocol){case"0":if(apply(config,{interval:100,delay:2e3,useResize:!0,useParent:!1,usePolling:!1},!0),config.isHost){if(!config.local){var domain=location.protocol+"//"+location.host,images=document.body.getElementsByTagName("img"),image,i=images.length;while(i--)if(image=images[i],image.src.substring(0,domain.length)===domain){config.local=image.src;break}config.local||(config.local=window)}var parameters={xdm_c:config.channel,xdm_p:0};config.local===window?(config.usePolling=!0,config.useParent=!0,config.local=location.protocol+"//"+location.host+location.pathname+location.search,parameters.xdm_e=config.local,parameters.xdm_pa=1):parameters.xdm_e=resolveUrl(config.local),config.container&&(config.useResize=!1,parameters.xdm_po=1),config.remote=appendQueryParameters(config.remote,parameters)}else apply(config,{channel:query.xdm_c,remote:query.xdm_e,useParent:!undef(query.xdm_pa),usePolling:!undef(query.xdm_po),useResize:!config.useParent&&config.useResize});stackEls=[new easyXDM.stack.HashTransport(config),new easyXDM.stack.ReliableBehavior({}),new easyXDM.stack.QueueBehavior({encode:!0,maxLength:4e3-config.remote.length}),new easyXDM.stack.VerifyBehavior({initiate:config.isHost})];break;case"1":stackEls=[new easyXDM.stack.PostMessageTransport(config)];break;case"2":config.isHost&&(config.remoteHelper=resolveUrl(config.remoteHelper)),stackEls=[new easyXDM.stack.NameTransport(config),new easyXDM.stack.QueueBehavior,new easyXDM.stack.VerifyBehavior({initiate:config.isHost})];break;case"3":stackEls=[new easyXDM.stack.NixTransport(config)];break;case"4":stackEls=[new easyXDM.stack.SameOriginTransport(config)];break;case"5":stackEls=[new easyXDM.stack.FrameElementTransport(config)];break;case"6":flashVersion||hasFlash(),stackEls=[new easyXDM.stack.FlashTransport(config)]}return stackEls.push(new easyXDM.stack.QueueBehavior({lazy:config.lazy,remove:!0})),stackEls}function chainStack(stackElements){for(var stackEl,defaults={incoming:function(message,origin){this.up.incoming(message,origin)},outgoing:function(message,recipient){this.down.outgoing(message,recipient)},callback:function(success){this.up.callback(success)},init:function(){this.down.init()},destroy:function(){this.down.destroy()}},i=0,len=stackElements.length;i<len;i++)stackEl=stackElements[i],apply(stackEl,defaults,!0),0!==i&&(stackEl.down=stackElements[i-1]),i!==len-1&&(stackEl.up=stackElements[i+1]);return stackEl}function removeFromStack(element){element.up.down=element.down,element.down.up=element.up,element.up=element.down=null}apply(easyXDM,{version:"2.4.19.0",query:query,stack:{},apply:apply,getJSONObject:getJSON,whenReady:whenReady,noConflict:noConflict}),easyXDM.DomHelper={on:on,un:un,requiresJSON:function(path){isHostObject(window,"JSON")||document.write('<script type="text/javascript" src="'+path+'"></script>')}},function(){var _map={};easyXDM.Fn={set:function(name,fn){_map[name]=fn},get:function(name,del){if(_map.hasOwnProperty(name)){var fn=_map[name];return del&&delete _map[name],fn}}}}(),easyXDM.Socket=function(config){var stack=chainStack(prepareTransportStack(config).concat([{incoming:function(message,origin){config.onMessage(message,origin)},callback:function(success){config.onReady&&config.onReady(success)}}])),recipient=getLocation(config.remote);this.origin=getLocation(config.remote),this.destroy=function(){stack.destroy()},this.postMessage=function(message){stack.outgoing(message,recipient)},stack.init()},easyXDM.Rpc=function(config,jsonRpcConfig){if(jsonRpcConfig.local)for(var method in jsonRpcConfig.local)if(jsonRpcConfig.local.hasOwnProperty(method)){var member=jsonRpcConfig.local[method];"function"==typeof member&&(jsonRpcConfig.local[method]={method:member})}var stack=chainStack(prepareTransportStack(config).concat([new easyXDM.stack.RpcBehavior(this,jsonRpcConfig),{callback:function(success){config.onReady&&config.onReady(success)}}]));this.origin=getLocation(config.remote),this.destroy=function(){stack.destroy()},stack.init()},easyXDM.stack.SameOriginTransport=function(config){var pub,frame,send,targetOrigin;return pub={outgoing:function(message,domain,fn){send(message),fn&&fn()},destroy:function(){frame&&(frame.parentNode.removeChild(frame),frame=null)},onDOMReady:function(){targetOrigin=getLocation(config.remote),config.isHost?(apply(config.props,{src:appendQueryParameters(config.remote,{xdm_e:location.protocol+"//"+location.host+location.pathname,xdm_c:config.channel,xdm_p:4}),name:IFRAME_PREFIX+config.channel+"_provider"}),frame=createFrame(config),easyXDM.Fn.set(config.channel,function(sendFn){return send=sendFn,setTimeout(function(){pub.up.callback(!0)},0),function(msg){pub.up.incoming(msg,targetOrigin)}})):(send=getParentObject().Fn.get(config.channel,!0)(function(msg){pub.up.incoming(msg,targetOrigin)}),setTimeout(function(){pub.up.callback(!0)},0))},init:function(){whenReady(pub.onDOMReady,pub)}}},easyXDM.stack.FlashTransport=function(config){var pub,frame,send,targetOrigin,swf,swfContainer;function onMessage(message,origin){setTimeout(function(){pub.up.incoming(message,targetOrigin)},0)}function addSwf(domain){var url=config.swf+"?host="+config.isHost,id="easyXDM_swf_"+Math.floor(1e4*Math.random());easyXDM.Fn.set("flash_loaded"+domain.replace(/[\-.]/g,"_"),function(){easyXDM.stack.FlashTransport[domain].swf=swf=swfContainer.firstChild;for(var queue=easyXDM.stack.FlashTransport[domain].queue,i=0;i<queue.length;i++)queue[i]();queue.length=0}),config.swfContainer?swfContainer="string"==typeof config.swfContainer?document.getElementById(config.swfContainer):config.swfContainer:(swfContainer=document.createElement("div"),apply(swfContainer.style,HAS_FLASH_THROTTLED_BUG&&config.swfNoThrottle?{height:"20px",width:"20px",position:"fixed",right:0,top:0}:{height:"1px",width:"1px",position:"absolute",overflow:"hidden",right:0,top:0}),document.body.appendChild(swfContainer));var flashVars="callback=flash_loaded"+encodeURIComponent(domain.replace(/[\-.]/g,"_"))+"&proto="+global.location.protocol+"&domain="+encodeURIComponent(getDomainName(global.location.href))+"&port="+encodeURIComponent(getPort(global.location.href))+"&ns="+encodeURIComponent(namespace);swfContainer.innerHTML="<object height='20' width='20' type='application/x-shockwave-flash' id='"+id+"' data='"+url+"'><param name='allowScriptAccess' value='always'></param><param name='wmode' value='transparent'><param name='movie' value='"+url+"'></param><param name='flashvars' value='"+flashVars+"'></param><embed type='application/x-shockwave-flash' FlashVars='"+flashVars+"' allowScriptAccess='always' wmode='transparent' src='"+url+"' height='1' width='1'></embed></object>"}return pub={outgoing:function(message,domain,fn){swf.postMessage(config.channel,message.toString()),fn&&fn()},destroy:function(){try{swf.destroyChannel(config.channel)}catch(e){}swf=null,frame&&(frame.parentNode.removeChild(frame),frame=null)},onDOMReady:function(){targetOrigin=config.remote,easyXDM.Fn.set("flash_"+config.channel+"_init",function(){setTimeout(function(){pub.up.callback(!0)})}),easyXDM.Fn.set("flash_"+config.channel+"_onMessage",onMessage),config.swf=resolveUrl(config.swf);var swfdomain=getDomainName(config.swf),fn=function(){easyXDM.stack.FlashTransport[swfdomain].init=!0,swf=easyXDM.stack.FlashTransport[swfdomain].swf,swf.createChannel(config.channel,config.secret,getLocation(config.remote),config.isHost),config.isHost&&(HAS_FLASH_THROTTLED_BUG&&config.swfNoThrottle&&apply(config.props,{position:"fixed",right:0,top:0,height:"20px",width:"20px"}),apply(config.props,{src:appendQueryParameters(config.remote,{xdm_e:getLocation(location.href),xdm_c:config.channel,xdm_p:6,xdm_s:config.secret}),name:IFRAME_PREFIX+config.channel+"_provider"}),frame=createFrame(config))};easyXDM.stack.FlashTransport[swfdomain]&&easyXDM.stack.FlashTransport[swfdomain].init?fn():easyXDM.stack.FlashTransport[swfdomain]?easyXDM.stack.FlashTransport[swfdomain].queue.push(fn):(easyXDM.stack.FlashTransport[swfdomain]={queue:[fn]},addSwf(swfdomain))},init:function(){whenReady(pub.onDOMReady,pub)}}},easyXDM.stack.PostMessageTransport=function(config){var pub,frame,callerWindow,targetOrigin;function _getOrigin(event){if(event.origin)return getLocation(event.origin);if(event.uri)return getLocation(event.uri);if(event.domain)return location.protocol+"//"+event.domain;throw"Unable to retrieve the origin of the event"}function _window_onMessage(event){var origin=_getOrigin(event);origin==targetOrigin&&event.data.substring(0,config.channel.length+1)==config.channel+" "&&pub.up.incoming(event.data.substring(config.channel.length+1),origin)}return pub={outgoing:function(message,domain,fn){callerWindow.postMessage(config.channel+" "+message,domain||targetOrigin),fn&&fn()},destroy:function(){un(window,"message",_window_onMessage),frame&&(callerWindow=null,frame.parentNode.removeChild(frame),frame=null)},onDOMReady:function(){if(targetOrigin=getLocation(config.remote),config.isHost){var waitForReady=function(event){event.data==config.channel+"-ready"&&(callerWindow="postMessage"in frame.contentWindow?frame.contentWindow:frame.contentWindow.document,un(window,"message",waitForReady),on(window,"message",_window_onMessage),setTimeout(function(){pub.up.callback(!0)},0))};on(window,"message",waitForReady),apply(config.props,{src:appendQueryParameters(config.remote,{xdm_e:getLocation(location.href),xdm_c:config.channel,xdm_p:1}),name:IFRAME_PREFIX+config.channel+"_provider"}),frame=createFrame(config)}else on(window,"message",_window_onMessage),callerWindow="postMessage"in window.parent?window.parent:window.parent.document,callerWindow.postMessage(config.channel+"-ready",targetOrigin),setTimeout(function(){pub.up.callback(!0)},0)},init:function(){whenReady(pub.onDOMReady,pub)}}},easyXDM.stack.FrameElementTransport=function(config){var pub,frame,send,targetOrigin;return pub={outgoing:function(message,domain,fn){send.call(this,message),fn&&fn()},destroy:function(){frame&&(frame.parentNode.removeChild(frame),frame=null)},onDOMReady:function(){targetOrigin=getLocation(config.remote),config.isHost?(apply(config.props,{src:appendQueryParameters(config.remote,{xdm_e:getLocation(location.href),xdm_c:config.channel,xdm_p:5}),name:IFRAME_PREFIX+config.channel+"_provider"}),frame=createFrame(config),frame.fn=function(sendFn){return delete frame.fn,send=sendFn,setTimeout(function(){pub.up.callback(!0)},0),function(msg){pub.up.incoming(msg,targetOrigin)}}):(document.referrer&&getLocation(document.referrer)!=query.xdm_e&&(window.top.location=query.xdm_e),send=window.frameElement.fn(function(msg){pub.up.incoming(msg,targetOrigin)}),pub.up.callback(!0))},init:function(){whenReady(pub.onDOMReady,pub)}}},easyXDM.stack.NameTransport=function(config){var pub,isHost,callerWindow,remoteWindow,readyCount,callback,remoteOrigin,remoteUrl;function _sendMessage(message){var url=config.remoteHelper+(isHost?"#_3":"#_2")+config.channel;callerWindow.contentWindow.sendMessage(message,url)}function _onReady(){isHost?2!=++readyCount&&isHost||pub.up.callback(!0):(_sendMessage("ready"),pub.up.callback(!0))}function _onMessage(message){pub.up.incoming(message,remoteOrigin)}function _onLoad(){callback&&setTimeout(function(){callback(!0)},0)}return pub={outgoing:function(message,domain,fn){callback=fn,_sendMessage(message)},destroy:function(){callerWindow.parentNode.removeChild(callerWindow),callerWindow=null,isHost&&(remoteWindow.parentNode.removeChild(remoteWindow),remoteWindow=null)},onDOMReady:function(){isHost=config.isHost,readyCount=0,remoteOrigin=getLocation(config.remote),config.local=resolveUrl(config.local),isHost?(easyXDM.Fn.set(config.channel,function(message){isHost&&"ready"===message&&(easyXDM.Fn.set(config.channel,_onMessage),_onReady())}),remoteUrl=appendQueryParameters(config.remote,{xdm_e:config.local,xdm_c:config.channel,xdm_p:2}),apply(config.props,{src:remoteUrl+"#"+config.channel,name:IFRAME_PREFIX+config.channel+"_provider"}),remoteWindow=createFrame(config)):(config.remoteHelper=config.remote,easyXDM.Fn.set(config.channel,_onMessage));var onLoad=function(){var w=callerWindow||this;un(w,"load",onLoad),easyXDM.Fn.set(config.channel+"_load",_onLoad),function test(){"function"==typeof w.contentWindow.sendMessage?_onReady():setTimeout(test,50)}()};callerWindow=createFrame({props:{src:config.local+"#_4"+config.channel},onLoad:onLoad})},init:function(){whenReady(pub.onDOMReady,pub)}}},easyXDM.stack.HashTransport=function(config){var pub,me=this,isHost,_timer,pollInterval,_lastMsg,_msgNr,_listenerWindow,_callerWindow,useParent,_remoteOrigin;function _sendMessage(message){if(_callerWindow){var url=config.remote+"#"+_msgNr+++"_"+message;(isHost||!useParent?_callerWindow.contentWindow:_callerWindow).location=url}}function _handleHash(hash){_lastMsg=hash,pub.up.incoming(_lastMsg.substring(_lastMsg.indexOf("_")+1),_remoteOrigin)}function _pollHash(){if(_listenerWindow){var href=_listenerWindow.location.href,hash="",indexOf=href.indexOf("#");indexOf!=-1&&(hash=href.substring(indexOf)),hash&&hash!=_lastMsg&&_handleHash(hash)}}function _attachListeners(){_timer=setInterval(_pollHash,pollInterval)}return pub={outgoing:function(message,domain){_sendMessage(message)},destroy:function(){window.clearInterval(_timer),!isHost&&useParent||_callerWindow.parentNode.removeChild(_callerWindow),_callerWindow=null},onDOMReady:function(){if(isHost=config.isHost,pollInterval=config.interval,_lastMsg="#"+config.channel,_msgNr=0,useParent=config.useParent,_remoteOrigin=getLocation(config.remote),isHost){if(apply(config.props,{src:config.remote,name:IFRAME_PREFIX+config.channel+"_provider"}),useParent)config.onLoad=function(){_listenerWindow=window,_attachListeners(),pub.up.callback(!0)};else{
var tries=0,max=config.delay/50;!function getRef(){if(++tries>max)throw new Error("Unable to reference listenerwindow");try{_listenerWindow=_callerWindow.contentWindow.frames[IFRAME_PREFIX+config.channel+"_consumer"]}catch(ex){}_listenerWindow?(_attachListeners(),pub.up.callback(!0)):setTimeout(getRef,50)}()}_callerWindow=createFrame(config)}else _listenerWindow=window,_attachListeners(),useParent?(_callerWindow=parent,pub.up.callback(!0)):(apply(config,{props:{src:config.remote+"#"+config.channel+new Date,name:IFRAME_PREFIX+config.channel+"_consumer"},onLoad:function(){pub.up.callback(!0)}}),_callerWindow=createFrame(config))},init:function(){whenReady(pub.onDOMReady,pub)}}},easyXDM.stack.ReliableBehavior=function(config){var pub,callback,idOut=0,idIn=0,currentMessage="";return pub={incoming:function(message,origin){var indexOf=message.indexOf("_"),ack=message.substring(0,indexOf).split(",");message=message.substring(indexOf+1),ack[0]==idOut&&(currentMessage="",callback&&callback(!0)),message.length>0&&(pub.down.outgoing(ack[1]+","+idOut+"_"+currentMessage,origin),idIn!=ack[1]&&(idIn=ack[1],pub.up.incoming(message,origin)))},outgoing:function(message,origin,fn){currentMessage=message,callback=fn,pub.down.outgoing(idIn+","+ ++idOut+"_"+message,origin)}}},easyXDM.stack.QueueBehavior=function(config){var pub,queue=[],waiting=!0,incoming="",destroying,maxLength=0,lazy=!1,doFragment=!1;function dispatch(){if(config.remove&&0===queue.length)return void removeFromStack(pub);if(!waiting&&0!==queue.length&&!destroying){waiting=!0;var message=queue.shift();pub.down.outgoing(message.data,message.origin,function(success){waiting=!1,message.callback&&setTimeout(function(){message.callback(success)},0),dispatch()})}}return pub={init:function(){undef(config)&&(config={}),config.maxLength&&(maxLength=config.maxLength,doFragment=!0),config.lazy?lazy=!0:pub.down.init()},callback:function(success){waiting=!1;var up=pub.up;dispatch(),up.callback(success)},incoming:function(message,origin){if(doFragment){var indexOf=message.indexOf("_"),seq=parseInt(message.substring(0,indexOf),10);incoming+=message.substring(indexOf+1),0===seq&&(config.encode&&(incoming=decodeURIComponent(incoming)),pub.up.incoming(incoming,origin),incoming="")}else pub.up.incoming(message,origin)},outgoing:function(message,origin,fn){config.encode&&(message=encodeURIComponent(message));var fragments=[],fragment;if(doFragment){while(0!==message.length)fragment=message.substring(0,maxLength),message=message.substring(fragment.length),fragments.push(fragment);while(fragment=fragments.shift())queue.push({data:fragments.length+"_"+fragment,origin:origin,callback:0===fragments.length?fn:null})}else queue.push({data:message,origin:origin,callback:fn});lazy?pub.down.init():dispatch()},destroy:function(){destroying=!0,pub.down.destroy()}}},easyXDM.stack.VerifyBehavior=function(config){var pub,mySecret,theirSecret,verified=!1;function startVerification(){mySecret=Math.random().toString(16).substring(2),pub.down.outgoing(mySecret)}return pub={incoming:function(message,origin){var indexOf=message.indexOf("_");indexOf===-1?message===mySecret?pub.up.callback(!0):theirSecret||(theirSecret=message,config.initiate||startVerification(),pub.down.outgoing(message)):message.substring(0,indexOf)===theirSecret&&pub.up.incoming(message.substring(indexOf+1),origin)},outgoing:function(message,origin,fn){pub.down.outgoing(mySecret+"_"+message,origin,fn)},callback:function(success){config.initiate&&startVerification()}}},easyXDM.stack.RpcBehavior=function(proxy,config){var pub,serializer=config.serializer||getJSON(),_callbackCounter=0,_callbacks={};function _send(data){data.jsonrpc="2.0",pub.down.outgoing(serializer.stringify(data))}function _createMethod(definition,method){var slice=Array.prototype.slice;return function(){var l=arguments.length,callback,message={method:method};l>0&&"function"==typeof arguments[l-1]?(l>1&&"function"==typeof arguments[l-2]?(callback={success:arguments[l-2],error:arguments[l-1]},message.params=slice.call(arguments,0,l-2)):(callback={success:arguments[l-1]},message.params=slice.call(arguments,0,l-1)),_callbacks[""+ ++_callbackCounter]=callback,message.id=_callbackCounter):message.params=slice.call(arguments,0),definition.namedParams&&1===message.params.length&&(message.params=message.params[0]),_send(message)}}function _executeMethod(method,id,fn,params){if(!fn)return void(id&&_send({id:id,error:{code:-32601,message:"Procedure not found."}}));var success,error;id?(success=function(result){success=emptyFn,_send({id:id,result:result})},error=function(message,data){error=emptyFn;var msg={id:id,error:{code:-32099,message:message}};data&&(msg.error.data=data),_send(msg)}):success=error=emptyFn,isArray(params)||(params=[params]);try{var result=fn.method.apply(fn.scope,params.concat([success,error]));undef(result)||success(result)}catch(ex1){error(ex1.message)}}return pub={incoming:function(message,origin){var data=serializer.parse(message);if(data.method)config.handle?config.handle(data,_send):_executeMethod(data.method,data.id,config.local[data.method],data.params);else{var callback=_callbacks[data.id];data.error?callback.error&&callback.error(data.error):callback.success&&callback.success(data.result),delete _callbacks[data.id]}},init:function(){if(config.remote)for(var method in config.remote)config.remote.hasOwnProperty(method)&&(proxy[method]=_createMethod(config.remote[method],method));pub.down.init()},destroy:function(){for(var method in config.remote)config.remote.hasOwnProperty(method)&&proxy.hasOwnProperty(method)&&delete proxy[method];pub.down.destroy()}}},global.easyXDM=easyXDM}(window,document,location,window.setTimeout,decodeURIComponent,encodeURIComponent),easyXDM=window.easyXDM.noConflict();var bind=function(fn,me){return function(){return fn.apply(me,arguments)}},XDomainEngine;XDomainEngine=function(){function XDomainEngine(type,shop_code,flavor,session,cookie_policy,metadata){null==shop_code&&(shop_code=""),null==flavor&&(flavor=""),null==session&&(session=""),null==cookie_policy&&(cookie_policy=""),null==metadata&&(metadata=""),this._onSocketMessage=bind(this._onSocketMessage,this),this._onSocketReady=bind(this._onSocketReady,this),this.promise=new Promise,this.url=Settings.url.analytics_session[type](shop_code,flavor,session,cookie_policy,metadata),this.socket=this._createSocket(this.url),this.timeout=this._checkForSocketTimeout()}return XDomainEngine.prototype.then=function(success,fail){return this.promise.then(success,fail)},XDomainEngine.prototype._timeout_message="XDomain retrieval of analytics_session timed out",XDomainEngine.prototype._nonexistant_message="Analytics_session does not exist",XDomainEngine.prototype._checkForSocketTimeout=function(){return setTimeout(function(_this){return function(){return _this.promise.reject(_this._timeout_message)}}(this),Settings.xdomain_session_timeout)},XDomainEngine.prototype._onSocketReady=function(){return this.socket.postMessage(Settings.iframe_message)},XDomainEngine.prototype._onSocketMessage=function(analytics_session,origin){if(origin===Settings.url.base&&"pending"===this.promise.state)return this.timeout&&clearTimeout(this.timeout),""===analytics_session?this.promise.reject(this._nonexistant_message):this.promise.resolve(analytics_session)},XDomainEngine.prototype._createSocket=function(url){return new easyXDM.Socket({remote:url,onMessage:this._onSocketMessage,onReady:this._onSocketReady})},XDomainEngine}();var URLHelper;URLHelper={appendData:function(url,payload){var hash,hash_index,main_url,ref,sign;return hash_index=url.indexOf("#"),ref=hash_index!==-1?[url.substring(0,hash_index),url.substring(hash_index)]:[url,""],main_url=ref[0],hash=ref[1],sign=main_url.indexOf("?")!==-1?"&":"?",""+main_url+sign+payload+hash},replaceParam:function(url,name,new_value){var regex;return regex=new RegExp("(.*[?&;]("+encodeURIComponent(name)+"|"+name+")=)([^&;]+)(.*)"),url.replace(regex,"$1"+encodeURIComponent(new_value)+"$4")},serialize:function(object){var key,query_string,value;if(!object||"object"!=typeof object)return!1;query_string="";for(key in object)value=object[key],"string"!=typeof value&&(value=JSON.stringify(value)),query_string+=encodeURIComponent(key)+"="+encodeURIComponent(value)+"&";return query_string.slice(0,-1)},extractGetParam:function(name,url){var extracted;return extracted=URLHelper.getParamsFromUrl(url),extracted[name]||null},getParamsFromUrl:function(url){var match,params,regex;null==url&&(url=Settings.url.current),url=url.split("#")[0],regex=/[?&;](.+?)=([^&;]+)/g,params={};while(match=regex.exec(url))params[decodeURIComponent(match[1])]=decodeURIComponent(match[2]);return params}};var b64chars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",b64tab=function(bin){for(var t={},i=0,l=bin.length;i<l;i++)t[bin.charAt(i)]=i;return t}(b64chars),fromCharCode=String.fromCharCode,cb_utob=function(c){if(c.length<2){var cc=c.charCodeAt(0);return cc<128?c:cc<2048?fromCharCode(192|cc>>>6)+fromCharCode(128|63&cc):fromCharCode(224|cc>>>12&15)+fromCharCode(128|cc>>>6&63)+fromCharCode(128|63&cc)}var cc=65536+1024*(c.charCodeAt(0)-55296)+(c.charCodeAt(1)-56320);return fromCharCode(240|cc>>>18&7)+fromCharCode(128|cc>>>12&63)+fromCharCode(128|cc>>>6&63)+fromCharCode(128|63&cc)},re_utob=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,utob=function(u){return u.replace(/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,cb_utob)},cb_encode=function(ccc){var padlen=[0,2,1][ccc.length%3],ord=ccc.charCodeAt(0)<<16|(ccc.length>1?ccc.charCodeAt(1):0)<<8|(ccc.length>2?ccc.charCodeAt(2):0);return[b64chars.charAt(ord>>>18),b64chars.charAt(ord>>>12&63),padlen>=2?"=":b64chars.charAt(ord>>>6&63),padlen>=1?"=":b64chars.charAt(63&ord)].join("")},btoa=function(b){return b.replace(/[\s\S]{1,3}/g,cb_encode)},_encode=function(u){return btoa(utob(u))},encode=function(u,urisafe){return urisafe?_encode(String(u)).replace(/[+\/]/g,function(m0){return"+"==m0?"-":"_"}).replace(/=/g,""):_encode(String(u))},encodeURI=function(u){return encode(u,!0)},re_btou=new RegExp(["[\xc0-\xdf][\x80-\xbf]","[\xe0-\xef][\x80-\xbf]{2}","[\xf0-\xf7][\x80-\xbf]{3}"].join("|"),"g"),cb_btou=function(cccc){switch(cccc.length){case 4:var cp=(7&cccc.charCodeAt(0))<<18|(63&cccc.charCodeAt(1))<<12|(63&cccc.charCodeAt(2))<<6|63&cccc.charCodeAt(3),offset=cp-65536;return fromCharCode(55296+(offset>>>10))+fromCharCode(56320+(1023&offset));case 3:return fromCharCode((15&cccc.charCodeAt(0))<<12|(63&cccc.charCodeAt(1))<<6|63&cccc.charCodeAt(2));default:return fromCharCode((31&cccc.charCodeAt(0))<<6|63&cccc.charCodeAt(1))}},btou=function(b){return b.replace(re_btou,cb_btou)},cb_decode=function(cccc){var len=cccc.length,padlen=len%4,n=(len>0?b64tab[cccc.charAt(0)]<<18:0)|(len>1?b64tab[cccc.charAt(1)]<<12:0)|(len>2?b64tab[cccc.charAt(2)]<<6:0)|(len>3?b64tab[cccc.charAt(3)]:0),chars=[fromCharCode(n>>>16),fromCharCode(n>>>8&255),fromCharCode(255&n)];return chars.length-=[0,0,2,1][padlen],chars.join("")},_atob=function(a){return a.replace(/\S{1,4}/g,cb_decode)},_decode=function(a){return btou(_atob(a))},decode=function(a){return _decode(String(a).replace(/[-_]/g,function(m0){return"-"==m0?"+":"/"}).replace(/[^A-Za-z0-9\+\/]/g,""))},Base64={encode:encode,encodeURI:encodeURI,decode:decode},AnalyticsUrl;AnalyticsUrl=function(){var TTL,URL_PARAM_NAME;URL_PARAM_NAME="skr_prm",TTL=6e4;function AnalyticsUrl(url){this.url=url}return AnalyticsUrl.prototype.format_params=function(mode,session,metadata){var link,new_link,param_hash,params;switch(null==metadata&&(metadata={}),params=[session,this._expiration(),metadata],param_hash=Base64.encodeURI(JSON.stringify(params)),mode.type){case"no_append":return this.url;case"append_to_param_link_url":return link=URLHelper.extractGetParam(mode.param,this.url),new_link=URLHelper.appendData(link,URL_PARAM_NAME+"="+param_hash),URLHelper.replaceParam(this.url,mode.param,new_link);default:return URLHelper.appendData(this.url,URL_PARAM_NAME+"="+param_hash)}},AnalyticsUrl.prototype.read_params=function(){var err,error,expiration,metadata,params,session,url_param;url_param=Base64.decode(URLHelper.extractGetParam(URL_PARAM_NAME,this.url));try{params=JSON.parse(url_param)}catch(error){return err=error,null}return session=params[0],expiration=params[1],metadata=params[2],expiration<(new Date).getTime()?null:{session:session,metadata:metadata}},AnalyticsUrl.prototype._expiration=function(){return(new Date).getTime()+TTL},AnalyticsUrl}();var DomainExtractor;DomainExtractor=function(){var NUMBER_DOT_ONLY_PATTERN;NUMBER_DOT_ONLY_PATTERN=/^[\d.]+$/;function DomainExtractor(hostname){this.hostname=hostname.toLowerCase()}return DomainExtractor.prototype.get=function(wildcard){var domain,domain_parts,matched_tld;return null==wildcard&&(wildcard=!0),this.hostname.match(NUMBER_DOT_ONLY_PATTERN)?null:(domain_parts=this.hostname.split("."),1===domain_parts.length?null:("www"===domain_parts[0]&&domain_parts.length>2&&domain_parts.shift(),matched_tld=this._matchedCustomTld(),domain=matched_tld?this._constructMatchedDomain(domain_parts,matched_tld):this._constructDomain(domain_parts),wildcard&&(domain="."+domain),domain))},DomainExtractor.prototype._constructDomain=function(domain_parts){var domain;domain=[domain_parts.pop()];while(domain_parts.length)if(domain.unshift(domain_parts.pop()),domain[0].length>3)break;return domain.join(".")},DomainExtractor.prototype._constructMatchedDomain=function(domain_parts,matched_tld){var matched_tld_length,next_subdomain;return matched_tld===domain_parts.join(".")?matched_tld:(matched_tld_length=matched_tld.split(".").length,(next_subdomain=domain_parts[domain_parts.length-matched_tld_length-1])+"."+matched_tld)},DomainExtractor.prototype._matchedCustomTld=function(){var dotted_tld,i,len,ref,tld;for(ref=this._customTlds(),i=0,len=ref.length;i<len;i++)if(tld=ref[i],dotted_tld="."+tld,this.hostname.indexOf(dotted_tld,this.hostname.length-dotted_tld.length)!==-1)return tld;return null},DomainExtractor.prototype._customTlds=function(){return Settings.custom_tlds.sort(function(a,b){return b.length-a.length})},DomainExtractor}();var UUID;UUID={_cryptoObj:window.crypto||window.msCrypto,_rng:function(){return UUID._cryptoObj?UUID._whatwgRNG():UUID._mathRNG()},_whatwgRNG:function(){var rnds8;return rnds8=new Uint8Array(16),UUID._cryptoObj.getRandomValues(rnds8),rnds8},_mathRNG:function(){var i,j,r,rnds;for(rnds=new Array(16),i=j=0;j<16;i=++j)0==(3&i)&&(r=4294967296*Math.random()),rnds[i]=r>>>(3&i)<<3&255;return rnds},_byteToHex:function(){var byteToHex,i,j,results;for(byteToHex=[],results=[],i=j=0;j<256;i=++j)results.push(byteToHex[i]=(i+256).toString(16).substr(1));return results}(),_bytesToUuid:function(buf,offset){var bth,i;return i=offset||0,bth=UUID._byteToHex,[bth[buf[i++]],bth[buf[i++]],bth[buf[i++]],bth[buf[i++]],"-",bth[buf[i++]],bth[buf[i++]],"-",bth[buf[i++]],bth[buf[i++]],"-",bth[buf[i++]],bth[buf[i++]],"-",bth[buf[i++]],bth[buf[i++]],bth[buf[i++]],bth[buf[i++]],bth[buf[i++]],bth[buf[i++]],"-",(new Date).getTime()].join("")},generate:function(options,buf,offset){var i,ii,j,rnds;if(i=buf&&offset||0,"string"==typeof options&&(buf="binary"===options?new Array(16):null,options=null),options=options||{},rnds=options.random||(options.rng||UUID._rng)(),rnds[6]=15&rnds[6]|64,rnds[8]=63&rnds[8]|128,buf)for(ii=j=0;j<16;ii=++j)buf[i+ii]=rnds[ii];return buf||UUID._bytesToUuid(rnds)}};var bind=function(fn,me){return function(){return fn.apply(me,arguments)}},Session;Session=function(){var key,method;for(key in Runnable)method=Runnable[key],Session.prototype[key]=method;function Session(plugins_manager){var ref;this.plugins_manager=plugins_manager,this._onConnectSessionSuccess=bind(this._onConnectSessionSuccess,this),this._onCreateSessionSuccess=bind(this._onCreateSessionSuccess,this),this._onSessionError=bind(this._onSessionError,this),this.promise=new Promise,this.domain=new DomainExtractor(Settings.url.hostname).get(),this._cleanUpCookies(),ref=this._getSessionFromCookie(),this.analytics_session=ref[0],this.cookie_policy=ref[1],this.transaction_id=UUID.generate()}return Session.prototype.then=function(success,fail){return this.promise.then(success,fail)},Session.prototype._commands={session:{create:function(shop_code,flavor,metadata){return this.cookie_policy="b"===metadata.cp?"basic":"full",this.shop_code=shop_code,this.flavor=flavor,this.metadata=metadata,this._extractAnalyticsSessionOnCreate()},connect:function(shop_code){var ref,skr_prm;return this.shop_code?"undefined"!=typeof console&&null!==console&&"function"==typeof console.warn?console.warn("Connect called multiple times"):void 0:(this.shop_code=shop_code,this.cookie_policy&&(this.metadata=this._getMetadataFromCookie()),this.plugins_manager.session=this,this.plugins_manager.notify("connect",{}),skr_prm=new AnalyticsUrl(Settings.url.current).read_params(),this._setAnalyticsSession(skr_prm),this._setAnalyticsMetadata(skr_prm),this.analytics_session||(ref=this._getSessionFromCacheCookie(),this.analytics_session=ref[0],this.cookie_policy=ref[1]),this.analytics_session?this.promise.resolve(this):this._extractAnalyticsSessionOnConnect("connect",shop_code))}}},Session.prototype._cleanUpCookies=function(){var cookie_data,cookie_name,cookie_settings,cookies,i,len,options,results;for(cookie_settings=Settings.cookies,this.domain&&(options={domain:this.domain}),cookies=[cookie_settings.basic.analytics.name,cookie_settings.basic.session.name,cookie_settings.full.analytics.name,cookie_settings.full.session.name],results=[],i=0,len=cookies.length;i<len;i++)cookie_name=cookies[i],(cookie_data=Biskoto.get(cookie_name))&&(cookie_data.version!==cookie_settings.version?results.push(Biskoto.expire(cookie_name,options)):results.push(void 0));return results},Session.prototype._getSessionFromCacheCookie=function(){var data;return(data=Biskoto.get(Settings.cookies.full.analytics.name))?[data.analytics_session,"full"]:(data=Biskoto.get(Settings.cookies.basic.analytics.name))?[data.analytics_session,"basic"]:[null,null]},Session.prototype._getSessionFromCookie=function(){var data;return(data=Biskoto.get(Settings.cookies.full.session.name))?[data.session,"full"]:(data=Biskoto.get(Settings.cookies.basic.session.name))?[data.session,"basic"]:[null,null]},Session.prototype._getMetadataFromCookie=function(){return Biskoto.get(Settings.cookies[this.cookie_policy].meta.name)},Session.prototype._extractAnalyticsSessionOnCreate=function(){return new XDomainEngine("create",this.shop_code,this.flavor,this.analytics_session,this.cookie_policy,encodeURIComponent(JSON.stringify(this.metadata))).then(this._onCreateSessionSuccess,this._onSessionError)},Session.prototype._extractAnalyticsSessionOnConnect=function(){return new XDomainEngine("connect",this.shop_code).then(this._onConnectSessionSuccess,this._onSessionError)},Session.prototype._onSessionError=function(){return this.promise.reject()},Session.prototype._onCreateSessionSuccess=function(session){return session?(this.analytics_session=session,this._createSessionCookie(),this.promise.resolve(this)):this.promise.reject()},Session.prototype._onConnectSessionSuccess=function(session){return session?(session=JSON.parse(session),this.analytics_session=session.session,this.cookie_policy=session.cookie_policy,this._createSessionCacheCookie(this.analytics_session),this.promise.resolve(this)):this.promise.reject()},Session.prototype._setAnalyticsSession=function(skr_prm){if(null!=skr_prm?skr_prm.session:void 0)return this.analytics_session=skr_prm.session,this.cookie_policy="b"===skr_prm.metadata.cp?"basic":"full",this._createSessionCookie()},Session.prototype._setAnalyticsMetadata=function(skr_prm){if(null!=skr_prm?skr_prm.metadata:void 0)return this.metadata=skr_prm.metadata,this._createMetadataCookie()},Session.prototype._createSessionCacheCookie=function(analytics_session){var cookie_data,options;return cookie_data={version:Settings.cookies.version,analytics_session:analytics_session},options={expires:Settings.cookies[this.cookie_policy].analytics.duration},this.domain&&(options.domain=this.domain),Biskoto.set(Settings.cookies[this.cookie_policy].analytics.name,cookie_data,options)},Session.prototype._createSessionCookie=function(){var delete_cookie,options,session_data;return session_data={version:Settings.cookies.version,session:this.analytics_session},options={expires:Settings.cookies[this.cookie_policy].session.duration},this.domain&&(options.domain=this.domain),Biskoto.set(Settings.cookies[this.cookie_policy].session.name,session_data,options),delete_cookie="basic"===this.cookie_policy?"full":"basic",Biskoto.expire(Settings.cookies[delete_cookie].session.name,options)},Session.prototype._createMetadataCookie=function(){var delete_cookie,options;return this.domain&&(options={domain:this.domain}),Biskoto.set(Settings.cookies[this.cookie_policy].meta.name,this.metadata,options),delete_cookie="basic"===this.cookie_policy?"full":"basic",Biskoto.expire(Settings.cookies[delete_cookie].meta.name,options)},Session}();var PluginsSettings;PluginsSettings={general:{fetch_plugins_url:"https://analytics.skroutz.gr/plugins"},plugins:{order_stash:{url:"https://analytics.skroutz.gr/js/plugins/order_stash.cb5fbb30.min.js",elements_to_hide:["#sa-badge-floating-plugin"]},badge:{url:"https://analytics.skroutz.gr/js/plugins/badge.d35279ba.min.js"},partner_sku_reviews:{url:"https://analytics.skroutz.gr/js/plugins/partner_sku_reviews.4e6f1d69.min.js"}},triggers:{order:"order_stash",connect:["badge","partner_sku_reviews"]}};var JSONP,uid;uid=0,JSONP=function(){var CALLBACK_PARAM;function JSONP(){}return CALLBACK_PARAM="callback",JSONP.fetch=function(url,data){var callback_name,promise;return null==data&&(data={}),promise=new Promise,callback_name=JSONP._callbackName(),window[callback_name]=function(response){return promise.resolve(response)},data[CALLBACK_PARAM]=callback_name,JSONP.load(url,data),promise},JSONP.load=function(url,data){var done,script;return done=!1,script=document.createElement("script"),script.type="text/javascript",script.src=data?JSONP._query(url,data):url,script.charset="utf-8",script.async=!0,script.onload=script.onreadystatechange=function(){var ref;if(!(done||this.readyState&&"loaded"!==(ref=this.readyState)&&"complete"!==ref)&&(done=!0,script.onload=script.onreadystatechange=null,script&&script.parentNode))return script.parentNode.removeChild(script)},document.getElementsByTagName("head")[0].appendChild(script)},JSONP._callbackName=function(){return"analytics_jsonp_"+ ++uid},JSONP._query=function(url,data){return URLHelper.appendData(url,URLHelper.serialize(data))},JSONP}();var indexOf=[].indexOf||function(item){for(var i=0,l=this.length;i<l;i++)if(i in this&&this[i]===item)return i;return-1},PluginsManager;PluginsManager=function(){function PluginsManager(){this.session=null,this.loaded_plugins=[]}return PluginsManager.prototype.notify=function(action,data){return this._fetchEnabledPlugins().then(function(_this){return function(){var i,len,plugin,plugins,results;if(plugins=PluginsSettings.triggers[action]){for("[object Array]"!==Object.prototype.toString.call(plugins)&&(plugins=[plugins]),results=[],i=0,len=plugins.length;i<len;i++)plugin=plugins[i],!_this._pluginIsLoaded(plugin)&&_this._pluginIsEnabled(plugin)&&(_this._publishPluginData(plugin,data)?results.push(_this._load(plugin)):results.push(void 0));return results}}}(this))},PluginsManager.prototype._publishPluginData=function(name,data){var base,base1,error;if("object"!=typeof data)try{data=JSON.parse(data)}catch(error){return!1}else data=JSON.parse(JSON.stringify(data));return window.sa_plugins||(window.sa_plugins={}),(base=window.sa_plugins)[name]||(base[name]={}),(base1=window.sa_plugins).settings||(base1.settings=this._settings()),data.shop_code=this.session.shop_code,data.analytics_session=this.session.analytics_session,data.configuration=this._plugin(name).configuration,data.data=this._plugin(name).data,window.sa_plugins[name]=data,!0},PluginsManager.prototype._settings=function(){return{url:{base:Settings.url.base,application_base:Settings.url.application_base},plugins:PluginsSettings.plugins}},PluginsManager.prototype._load=function(name){return this.loaded_plugins.push(name),JSONP.load(this._pluginSettings(name).url)},PluginsManager.prototype._fetchEnabledPlugins=function(){var data;return data={shop_code:this.session.shop_code},this.fetched||(this.fetched=JSONP.fetch(PluginsSettings.general.fetch_plugins_url,data).then(function(_this){return function(response){return _this.enabled_plugins=response.plugins}}(this)))},PluginsManager.prototype._pluginIsLoaded=function(name){return indexOf.call(this.loaded_plugins,name)>=0},PluginsManager.prototype._pluginIsEnabled=function(name){var plugin;return indexOf.call(function(){var i,len,ref,results;for(ref=this.enabled_plugins,results=[],i=0,len=ref.length;i<len;i++)plugin=ref[i],results.push(plugin.name);return results}.call(this),name)>=0},PluginsManager.prototype._pluginSettings=function(name){return PluginsSettings.plugins[name]},PluginsManager.prototype._plugin=function(name){var plugin;return function(){var i,len,ref,results;for(ref=this.enabled_plugins,results=[],i=0,len=ref.length;i<len;i++)plugin=ref[i],plugin.name===name&&results.push(plugin);return results}.call(this)[0]},PluginsManager}();var BrowserHelper;BrowserHelper=function(){function BrowserHelper(){}return BrowserHelper.checkImages=function(){var img,img_enabled,parent,promise,src;return promise=new Promise,img_enabled=!1,parent=document.getElementsByTagName("head")[0],src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",img=document.createElement("img"),img.onload=img.onerror=function(){return img_enabled=!0},img.src=src,parent.appendChild(img),setTimeout(function(){return promise.resolve(img.complete||img_enabled),parent.removeChild(img)},0),promise},BrowserHelper}();var Reporter,unique_id;unique_id=0,Reporter=function(){function Reporter(){this.transport="img",this.transport_ready=this._determineTransport()}return Reporter.prototype.then=function(success,fail){return this.transport_ready.then(success,fail)},Reporter.prototype.sendBeacon=function(url,data){var promise;return promise=new Promise,this.transport_ready.then(function(_this){return function(){return _this._handleJob(url,data,promise)}}(this)),promise},Reporter.prototype._determineTransport=function(){return BrowserHelper.checkImages().then(function(_this){return function(images_enabled){if(!images_enabled)return _this.transport="script"}}(this))},Reporter.prototype._handleJob=function(url,payload,promise){var data;return data=URLHelper.serialize(payload),url=URLHelper.appendData(url,data),this._createTransport(url,promise)},Reporter.prototype._createTransport=function(url,promise){var element,sibling,transport_options;return transport_options={buster:+new Date+"_"+unique_id++},"script"===this.transport&&(transport_options.no_images=""),element=document.createElement(this.transport),element.onload=function(_this){return function(){return _this._removeElement(element),promise.resolve()}}(this),element.onerror=function(_this){return function(){return _this._removeElement(element),promise.reject()}}(this),element.src=URLHelper.appendData(url,URLHelper.serialize(transport_options)),sibling=document.getElementsByTagName("script")[0],sibling.parentNode.insertBefore(element,sibling),promise},Reporter.prototype._removeElement=function(elem){if(elem&&elem.parentNode)return elem.parentNode.removeChild(elem)},Reporter}();var ValidationError,extend=function(child,parent){for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);function ctor(){this.constructor=child}return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty,slice=[].slice;ValidationError=function(superClass){extend(ValidationError,superClass);function ValidationError(message,reason){this.message=message,this.reason=reason,this.name="ValidationError",Error.captureStackTrace?Error.captureStackTrace(this,ValidationError):this.stack=(new Error).stack}return ValidationError}(Error);var Validator;Validator=function(){function Validator(data,action){if(this.data=data,this.action=null!=action?action:"","string"==typeof this.data)try{this.data=JSON.parse(this.data)}catch(undefined){}if("object"!=typeof this.data)throw new ValidationError("Invalid JSON object"+(this.action?" in '"+this.action+"' action":"")+":\n"+this.data,{error:"invalid_object",action:this.action})}return Validator.prototype.present=function(){var base,i,key,keys,len;for(keys=1<=arguments.length?slice.call(arguments,0):[],i=0,len=keys.length;i<len;i++)if(key=keys[i],void 0===this.data[key]||null===this.data[key]||""===("function"==typeof(base=this.data[key]).trim?base.trim():void 0))throw new ValidationError("Missing or empty '"+key+"'"+(this.action?" in '"+this.action+"' action":""),{error:"not_present",key:key,action:this.action});return this},Validator}();var ActionsManager;ActionsManager=function(){var key,method;for(key in Runnable)method=Runnable[key],ActionsManager.prototype[key]=method;function ActionsManager(session,plugins_manager){this.session=session,this.plugins_manager=plugins_manager,this.reporter=new Reporter,this.pageview_timeout=null,Settings.send_auto_pageview&&this._setPageViewTimeout()}return ActionsManager.prototype._setPageViewTimeout=function(){return this.pageview_timeout=setTimeout(function(_this){return function(){return _this._commands.site.sendPageView.call(_this)}}(this),Settings.auto_pageview_timeout)},ActionsManager.prototype._commands={yogurt:{productClick:function(data,redirect_callback,redirect_url,url_mode){return null==url_mode&&(url_mode={type:"default"}),clearTimeout(this.pageview_timeout),this._reportAction("yogurt","productClick",data,function(_this){return function(){var error;if(redirect_callback&&redirect_url){redirect_url=new AnalyticsUrl(redirect_url).format_params(url_mode,_this.session.analytics_session,_this.session.metadata);try{return redirect_callback(redirect_url)}catch(error){return Settings.redirectTo(redirect_url)}}}}(this))}},ecommerce:{addOrder:function(data,callback){var e,error;clearTimeout(this.pageview_timeout);try{new Validator(data,"addOrder").present("order_id")}catch(error){if(e=error,"ValidationError"===e.name)return"undefined"!=typeof console&&null!==console&&"function"==typeof console.error?console.error(Settings.flavor+"Analytics | "+e.message):void 0;throw e}if(this._reportAction("ecommerce","addOrder",data,function(){if(callback)return callback()}),"full"===this.session.cookie_policy)return this.plugins_manager.notify("order",data)},addItem:function(data,callback){var e,error;clearTimeout(this.pageview_timeout);try{new Validator(data,"addItem").present("order_id","product_id")}catch(error){if(e=error,"ValidationError"===e.name)return"undefined"!=typeof console&&null!==console&&"function"==typeof console.error?console.error(Settings.flavor+"Analytics | "+e.message):void 0;throw e}return this._reportAction("ecommerce","addItem",data,function(){if(callback)return callback()})}},site:{sendPageView:function(){return this._reportAction("site","sendPageView")}}},ActionsManager.prototype._reportAction=function(category,type,data,cb){var payload,url;return url=Settings.url.beacon(this.session.analytics_session),payload=this._buildBeaconPayload(category,type,data),this.reporter.sendBeacon(url,payload).then(function(_this){return function(){return cb&&cb()}}(this))},ActionsManager.prototype._buildBeaconPayload=function(category,type,data){var params,payload;return null==data&&(data="{}"),"string"!=typeof data&&(data=JSON.stringify(data)),payload={},params=Settings.params,payload[params.transaction_id]=this.session.transaction_id,payload[params.url]=Settings.url.current,payload[params.referrer]=Settings.url.referrer,payload[params.shop_code]=this.session.shop_code,payload[params.metadata]=this.session.metadata||"",payload[params.cookie_policy]=this.session.cookie_policy,
payload[params.actions]=[{category:category,type:type,data:data}],payload},ActionsManager}();var Analytics;Analytics=function(){function Analytics(){var plugins_manager;plugins_manager=new PluginsManager,new Session(plugins_manager).run().then(function(_this){return function(session){return _this.actions=new ActionsManager(session,plugins_manager).run(),_this._live()}}(this))}return Analytics.prototype._live=function(){return Settings.window[Settings.command_queue_name]=function(_this){return function(){var base;return((base=Settings.window[Settings.command_queue_name]).q||(base.q=[])).push(arguments),_this.actions.run()}}(this)},Analytics}(),(global[Settings.command_queue_name]=global[Settings.command_queue_name]||{}).analytics=new Analytics}(this);